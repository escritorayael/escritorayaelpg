// PRODUCTOS DISPONIBLES
const libros = {
 "cuando-todo-calla": {
    name: "Cuando Todo Calla",
    description: "Una historia de amor, pérdidas, resiliencia y segundas oportunidades...cuando el escándalo mediático lo cambia todo. (Spanish Edition). La vida de Lilian Mann se derrumba tras una pérdida devastadora. Decidida a reconstruirse, se enfrenta a la soledad, al juicio público y a las heridas que no se ven. En su camino, conoce a Jack Bremm, un hombre marcado por el dolor, perseguido por los medios y atrapado en una lucha por limpiar su nombre. Juntos, deberán aprender a confiar cuando todo parece perdido, a amar en medio del caos, y a encontrar sentido en lo que no tiene explicación. En un mundo donde el silencio puede ser condena o refugio, Lilian y Jack descubren que a veces, el verdadero poder está en volver a empezar. Cuando todo calla es una novela profunda y emotiva que entrelaza romance, drama contemporáneo y una poderosa mirada sobre la fuerza interior que emerge tras el colapso.",
    description_en: "A story of love, loss, resilience, and second chances... when a media scandal changes everything. (Spanish Edition) Lilian Mann’s life falls apart after a devastating loss. Determined to rebuild herself, she faces loneliness, public judgment, and invisible wounds. Along the way, she meets Jack Bremm—a man scarred by pain, hunted by the press, and caught in a battle to clear his name. Together, they must learn to trust when all seems lost, to love amidst chaos, and to find meaning in the inexplicable. In a world where silence can be a sentence or a refuge, Lilian and Jack discover that sometimes, true power lies in beginning again. When All Falls Silent is a deeply emotional novel that weaves romance, contemporary drama, and a powerful look at the inner strength that emerges after collapse.",
    image: "IMAGES/cuando todo calla book.png",
    image2: "IMAGES/cuando todo calla book back.png",
    prices: {
      physical: 18.90,
      digital: 6.90,
      audio: 14.99
    },
    specs: {
      physical: {
        pages: "288 pages",
        language: "Spanish",
        publication: "June 1, 2025",
        dimensions: "6 x 0.65 x 9 inches"
      },
      digital: {
        pages: "258 pages",
        language: "Spanish",
        publication: "May 31, 2025",
        dimensions: "1.9 MB"
      },
      audio: {
        pages: "Unabridged",
        language: "Spanish",
        publication: "June 1, 2025",
        dimensions: "MP3"
      }
    },
    rating: {
      value: 5.0,
      count: 89
    }
  },
  "nombre-de-ella": {
    name: "En el Nombre de Ella",
    description: "Un inocente juego virtual conecta a Silvina Stern, una periodista de investigación decidida, con Alessandro De Luca, un cirujano de renombre internacional. Sin verse, sin siquiera conocerse, sus almas se encuentran mucho antes que sus cuerpos. Lo que comienza como un intercambio de palabras y miradas veladas termina arrastrándolos a Roma, a un torbellino donde secretos letales, corrupción farmacéutica y poder sin escrúpulos amenazan con destruirlo todo. Entre conspiraciones, traiciones y batallas invisibles, Silvina y Alessandro se ven forzados a confiar el uno en el otro en una carrera contra el tiempo. Pero en un mundo donde la mentira se oculta tras sonrisas amables y contratos brillantes, amar puede ser el mayor riesgo de todos. En el Nombre de Ella es un thriller vibrante que fusiona pasión, peligro y verdad en una historia donde la emoción nunca da tregua y el amor puede ser la única salida.",
    description_en: "A story of love, loss, resilience, and second chances... when a media scandal changes everything. (Spanish Edition) Lilian Mann’s life falls apart after a devastating loss. Determined to rebuild herself, she faces loneliness, public judgment, and invisible wounds. Along the way, she meets Jack Bremm—a man scarred by pain, hunted by the press, and caught in a battle to clear his name. Together, they must learn to trust when all seems lost, to love amidst chaos, and to find meaning in the inexplicable. In a world where silence can be a sentence or a refuge, Lilian and Jack discover that sometimes, true power lies in beginning again. When All Falls Silent is a deeply emotional novel that weaves romance, contemporary drama, and a powerful look at the inner strength that emerges after collapse.",
    image: "IMAGES/en el nombre de ella book.png",
    image2: "IMAGES/en el nombre de ella book back.png",
    prices: {
      physical: 17.99,
      digital: 6.90,
      audio: 13.49
    },
    specs: {
      physical: {
        pages: "306 pages",
        language: "Spanish",
        publication: "April 28, 2025",
        dimensions: "6 x 0.77 x 9 inches"
      },
      digital: {
        pages: "273 pages",
        language: "Spanish",
        publication: "April 27, 2025",
        dimensions: "1.1 MB"
      },
      audio: {
        pages: "Unabridged",
        language: "Spanish",
        publication: "June 13, 2025",
        dimensions: "MP3"
      }
    },
    rating: {
      value: 4.0,
      count: 54
    }
  },
  "amina-defiance": {
    name: "Amina: La Princesa Rebelde",
    description: "Amina, hija de una poderosa familia real kuwaití, siempre supo que su destino no le pertenecía. Prometida en matrimonio con un hombre al que no ama y atrapada en una jaula de oro tejida por la tradición y las expectativas, decide arriesgarlo todo: escapar. Buscando asilo en la embajada de Panamá en Londres, Amina encuentra aliados inesperados en Isabel, la embajadora, y Alex Fitzwilliam, un brillante abogado británico. Pero lo que comienza como una batalla legal por la libertad pronto se convierte en una red de intrigas internacionales, donde los derechos humanos, los intereses políticos y los deseos personales se entrelazan. Y detrás de todo, una sombra acecha: el servicio de inteligencia británico, el MI6, con sus propios intereses ocultos en el caso de Amina. Desde los palacios de Kuwait hasta los pasillos del poder en Europa, desde el deber impuesto hasta un amor prohibido, Amina, la Princesa Rebelde es una historia de coraje, identidad y del alto precio de elegir tu propio camino.",
    description_en: "Amina, daughter of a powerful Kuwaiti royal family, always knew her destiny was not her own. Promised in marriage to a man she doesn't love and trapped in a gilded cage woven by tradition and expectations, she decides to risk everything: escape. Seeking asylum in the Panamanian embassy in London, Amina finds unexpected allies in Isabel, the ambassador, and Alex Fitzwilliam, a brilliant British lawyer. But what begins as a legal battle for freedom soon becomes an international web of intrigue—where human rights, political interests, and personal desires collide. And behind it all, a shadow looms: British intelligence service MI6, with its own hidden agenda in Amina’s case. From Kuwaiti palaces to European power halls, from duty imposed to forbidden love, Amina: The Defiant Princess is a gripping story of courage, identity, and the high price of choosing your own path.",
    image: "IMAGES/amina book.png",
    image2: "IMAGES/amina book back.png",
    prices: {
      physical: 18.90,
      digital: 6.90,
      audio: 17.99
    },
    specs: {
      physical: {
        pages: "357 pages",
        language: "English",
        publication: "June 26, 2025",
        dimensions: "6 x 0.81 x 9 inches"
      },
      digital: {
        pages: "361 pages",
        language: "English",
        publication: "June 25, 2025",
        dimensions: "1.0 MB"
      },
      audio: {
        pages: "Unabridged",
        language: "English",
        publication: "June 26, 2025",
        dimensions: "MP3"
      }
    },
    rating: {
      value: 5.0,
      count: 132
    }
  },

"destinos-entrelazados": {
  name: "Destinos Entrelazados",
  description: "Experimenta la intensidad de una historia cargada de amor, peligro y dilemas éticos. Raquel, una periodista argentina audaz, y Walter, un joven en busca de libertad, se encuentran en un peligroso cruce de caminos. Desafiando todo y enfrentándose a fuerzas que superan la comprensión humana. Cuando la vida de Raquel toma un giro inesperado al descubrir que espera un hijo de Walter, su destino se entrelaza aún más con el tejido complejo de la historia. Obligada a distanciarse de su familia conservadora, emprende un emocionante viaje hacia Italia con su amiga Silvia, solo para verse envuelta en el caos de los años de terrorismo que sacuden Europa y Medio Oriente. En Roma, Raquel se encuentra con un enigmático médico estadounidense que introduce un nuevo capítulo de amor y misterio en su vida. Sin embargo, la trama se intensifica cuando Raquel se convierte en el objetivo de las Brigadas Rojas y en una pieza clave para desmantelar la red terrorista detrás de la masacre de Múnich.",
  description_en: "Experience the intensity of a story charged with love, danger, and ethical dilemmas. Raquel, a bold Argentine journalist, and Walter, a young man in search of freedom, cross paths in a dangerous intersection. Their lives take a dramatic turn when Raquel discovers she’s pregnant with Walter’s child, further entangling her fate in the intricate fabric of history. Forced to distance herself from her conservative family, she embarks on a thrilling journey to Italy with her friend Silvia, only to find herself swept into the chaos of terrorism shaking Europe and the Middle East. In Rome, she encounters a mysterious American doctor who brings a new chapter of love and mystery. But everything intensifies when Raquel becomes the target of the Red Brigades and a key figure in dismantling the terrorist network behind the Munich massacre.",
  image: "IMAGES/destinos entrelazados.png",
  image2: "IMAGES/destinos entrelazados back.png",
  prices: {
    physical: 18.50,
    digital: 6.90,
    audio: 15.49
  },
  specs: {
    physical: {
      pages: "435 pages",
      language: "Spanish",
      publication: "January 24, 2024",
      dimensions: "5.5 x 1.0 x 8.5 inch"
    },
    digital: {
      pages: "437 pages",
      language: "Spanish",
      publication: "January 23, 2024",
      dimensions: "1.0 MB"
    },
    audio: {
      pages: "Unabridged",
      language: "Spanish",
      publication: "January 24, 2024",
      dimensions: "MP3"
    }
  },
  rating: {
    value: 4.5,
    count: 10
  }
},

"identidades-ocultas": {
  name: "Identidades Ocultas",
  description: "Sumérgete en Identidades Ocultas, una novela que combina la emoción del thriller tecnológico con una conmovedora historia de amor. Sigue a Laura Trend, una mujer fuerte y determinada, mientras enfrenta una peligrosa trama de cibercrimen que amenaza con desestabilizar la economía mundial y poner en riesgo la seguridad global. En el centro de esta trepidante historia, Laura, una experta en seguridad informática, lucha por detener a un grupo de hackers decididos a tomar el control de los centros financieros y de una central atómica. Pero su lucha no es solo contra los criminales; Laura también enfrenta sus propios desafíos personales, incluyendo una nueva relación que podría cambiar su vida para siempre. Greg, también viudo y padre de dos adolescentes, entra en la vida de Laura, y aunque los separa un océano, la conexión entre ellos es innegable. A medida que enfrentan juntos las amenazas globales, también sueñan con ensamblar sus familias y construir una vida en común. Su historia de amor, marcada por la pérdida, la esperanza y el deseo de un nuevo comienzo, añade una dimensión emocional única a este thriller electrizante.",
  description_en: "Immerse yourself in 'Hidden Identities', a novel that blends the excitement of a tech thriller with a heartfelt love story. Follow Laura Trend, a strong and determined woman, as she confronts a dangerous cybercrime plot threatening to destabilize the global economy and endanger international security. At the heart of this gripping story, Laura, an expert in cybersecurity, fights to stop a group of hackers determined to take control of financial centers and a nuclear power plant. But her battle is not only against criminals—Laura also faces personal challenges, including a new relationship that could change her life forever. Greg, also widowed and father of two teenagers, enters Laura’s life. Despite the ocean that separates them, the connection is undeniable. As they face global threats together, they also dream of blending their families and building a new life. Their love story, marked by loss, hope, and the desire for a fresh start, adds a uniquely emotional dimension to this electrifying thriller.",
  image: "IMAGES/identidades ocultas book.png",
  image2: "IMAGES/identidades ocultas back.png",
  prices: {
    physical: 18.90,
    digital: 6.90,
    audio: 17.90
  },
  specs: {
    physical: {
      pages: "334 pages",
      language: "Spanish",
      publication: "August 15, 2024",
      dimensions: "6 x 0.84 x 9 inches"
    },
    digital: {
      pages: "255 pages",
      language: "Spanish",
      publication: "August 14, 2024",
      dimensions: "814 KB"
    },
    audio: {
      pages: "Unabridged",
      language: "Spanish",
      publication: "August 15, 2024",
      dimensions: "MP3"
    }
  },
  rating: {
    value: 4.1,
    count: 5
  }
},

"encuentros-casuales": {
  name: "Encuentros Casuales",
  description: "La brillante científica Eliana se encuentra con un descubrimiento revolucionario que tiene la capacidad de detener una epidemia devastadora en el sudeste asiático. Su decisión de actuar furtivamente desencadena una serie de eventos que desafían no solo su carrera, sino también su vida y la de su hija. Por otro lado, Lilit, buscando claridad y propósito en un viaje a Francia, conoce a Leo, un reconocido periodista y escritor. Su conexión es inmediata, pero su romance se ve interrumpido cuando Lilit se encuentra atrapada en una situación inusual en una cumbre internacional en París. La atención del mundo está en Francia, mientras en Asia claman por la salvación de sus seres queridos del virus mortal. Eliana lucha contra el tiempo y las complejidades de la diplomacia global, planteando un dilema profundo: la batalla entre ideología y humanidad. En un mundo donde las divisiones políticas y religiosas pueden costar vidas, Encuentros Casuales desafía a sus personajes y lectores a considerar lo que realmente importa. ¿Puede un solo acto de valentía y compasión cambiar el curso de los acontecimientos?",
  description_en: "Brilliant scientist Eliana stumbles upon a groundbreaking discovery that could halt a devastating epidemic in Southeast Asia. Her secretive decision to act sets off a chain of events that threaten not only her career but also her life and her daughter’s. Meanwhile, Lilit, searching for clarity and purpose during a trip to France, meets Leo, a renowned journalist and writer. Their connection is immediate, but their budding romance is interrupted when Lilit is caught in an unusual situation at an international summit in Paris. As the world watches France, Asia cries out for salvation from a deadly virus. Eliana races against time and the complexities of global diplomacy, raising a profound dilemma: the battle between ideology and humanity. In a world where political and religious divisions can cost lives, 'Casual Encounters' challenges its characters and readers to consider what truly matters. Can a single act of bravery and compassion change the course of events?",
  image: "IMAGES/encuentros casuales book.png",
  image2: "IMAGES/encuentros casuales back.png",
  prices: {
    physical: 17.90,
    digital: 6.90,
    audio: 16.70
  },
  specs: {
    physical: {
      pages: "333 pages",
      language: "Spanish",
      publication: "May 20, 2024",
      dimensions: "6 x 0.84 x 9 inches"
    },
    digital: {
      pages: "251 pages",
      language: "Spanish",
      publication: "May 19, 2024",
      dimensions: "385 KB"
    },
    audio: {
      pages: "Unabridged",
      language: "Spanish",
      publication: "May 20, 2024",
      dimensions: "MP3"
    }
  },
  rating: {
    value: 5.0,
    count: 3
  }
},

"sobrevivir-vida": {
  name: "Como Sobrevivir a la Vida: Simples Consejos para Lograrlo",
  description: "¡Descubre cómo superar los obstáculos de la vida y encontrar la plenitud con Cómo Sobrevivir a la Vida de Yael Goldmann!. Cómo Sobrevivir a la Vida no solo te ofrece una mirada honesta a los desafíos comunes de la vida, sino que también te brinda herramientas prácticas respaldadas por evidencia para superar la adversidad. Con la sabiduría de autores y pensadores de todo el mundo, este libro te guiará hacia el significado y la plenitud en tu propia vida. Ya sea que estés buscando superar la adversidad, encontrar propósito o alcanzar tu máximo potencial, este libro te proporcionará la inspiración y la esperanza que necesitas para seguir adelante.",
  description_en: "Discover how to overcome life’s obstacles and find fulfillment with Yael Goldmann’s 'How to Survive Life'. This book not only offers an honest look at life’s common challenges but also provides practical, evidence-based tools to overcome adversity. Drawing on the wisdom of authors and thinkers from around the world, it guides you toward meaning and wholeness in your own journey. Whether you're seeking to overcome hardship, find purpose, or reach your full potential, this book offers the inspiration and hope you need to keep moving forward.",
  image: "IMAGES/sobrevivir vida book.png",
  image2: "IMAGES/sobrevivir vida back.png",
  prices: {
    physical: 18.55,
    digital: 6.95,
    audio: 16.70
  },
  specs: {
    physical: {
      pages: "142 pages",
      language: "Spanish",
      publication: "April 2, 2024",
      dimensions: "6 x 0.32 x 9 inches"
    },
    digital: {
      pages: "144 pages",
      language: "Spanish",
      publication: "April 2, 2024",
      dimensions: "12.1 MB"
    },
    audio: {
      pages: "Unabridged",
      language: "Spanish",
      publication: "April 2, 2024",
      dimensions: "MP3"
    }
  },
  rating: {
    value: 5.0,
    count: 2
  }
},

"jaque-reina": {
  name: "Jaque a la Reina: Códigos Mortales",
  description: "Emma Glow, una joven marcada por el destino, retorna a Estados Unidos tras la trágica pérdida de sus padres en Caracas. Su corazón, aún envuelto en sombras, encuentra un rayo de luz en su pasión por el ajedrez, que la lleva a un encuentro fortuito con un enigmático jugador que cambiará el rumbo de su existencia para siempre. Incapaz de apartar de su mente al misterioso hombre, Emma se embarca en un viaje repleto de intriga, pero también de romance y esperanza. Su brillantez y creatividad han dado forma a una plataforma innovadora que revolucionará la post-producción cinematográfica. Al llegar a Los Ángeles para presentar su invención al mundo de Hollywood, Emma se sumerge en un torbellino de emociones donde se entrelazan el amor y la lucha por el poder.",
  description_en: "Emma Glow, a young woman marked by destiny, returns to the United States after the tragic loss of her parents in Caracas. Her heart, still cloaked in shadows, finds a glimmer of light in her passion for chess, leading her to a fateful encounter with a mysterious player who will forever change her life. Unable to forget the enigmatic man, Emma embarks on a journey filled with intrigue, romance, and hope. Her brilliance and creativity have given shape to an innovative platform set to revolutionize film post-production. Upon arriving in Los Angeles to present her invention to the Hollywood industry, Emma is swept into a whirlwind of emotions where love and the struggle for power become inextricably intertwined.",
  image: "IMAGES/jaque reina book.png",
  image2: "IMAGES/jaque reina back.png",
  prices: {
    physical: 17.70,
    digital: 6.90,
    audio: 16.70
  },
  specs: {
    physical: {
      pages: "375 pages",
      language: "Spanish",
      publication: "February 27, 2024",
      dimensions: "5 x 0.8 x 8.5 inch"
    },
    digital: {
      pages: "377 pages",
      language: "Spanish",
      publication: "February 26, 2024",
      dimensions: "733 KB"
    },
    audio: {
      pages: "Unabridged",
      language: "Spanish",
      publication: "February 27, 2024",
      dimensions: "MP3"
    }
  },
  rating: {
    value: 3.6,
    count: 7
  }
}

};


// CARGAR DETALLES DEL PRODUCTO
const params = new URLSearchParams(window.location.search);
const slug = params.get("producto");
const book = libros[slug];

function traducirSpecs(specs) {
  const currentLang = localStorage.getItem("language") || "es";
  const langMap = {
    Spanish: { es: "Español", en: "Spanish" },
    English: { es: "Inglés", en: "English" },
    Unabridged: { es: "Completo", en: "Unabridged" },
    MP3: { es: "MP3", en: "MP3" }
  };

  const meses = {
    en: {
      January: "enero", February: "febrero", March: "marzo", April: "abril",
      May: "mayo", June: "junio", July: "julio", August: "agosto",
      September: "septiembre", October: "octubre", November: "noviembre", December: "diciembre"
    },
    es: {
      enero: "January", febrero: "February", marzo: "March", abril: "April",
      mayo: "May", junio: "June", julio: "July", agosto: "August",
      septiembre: "September", octubre: "October", noviembre: "November", diciembre: "December"
    }
  };

  const traducirFecha = (fecha) => {
    const partes = fecha.split(" ");
    const month = partes[0];
    const day = partes[1].replace(",", "");
    const year = partes[2];
    const nuevoMes = meses.en[month] ? meses.en[month] : (meses.es[month] || month);
    const traducidoMes = meses[currentLang][month] || nuevoMes;
    return `${traducidoMes} ${day}, ${year}`;
  };

  return {
    pages: specs.pages?.replace("pages", currentLang === "es" ? "páginas" : "pages") || "-",
    language: langMap[specs.language]?.[currentLang] || specs.language,
    publication: traducirFecha(specs.publication),
    dimensions: specs.dimensions?.replace("MP3", currentLang === "es" ? "MP3" : "MP3") || "-"
  };
}


// FORMATO Y PRECIO
function selectFormatWithDelay(format) {
  const loader = document.getElementById("fullPageLoader");
  loader.style.display = "flex";

  // Desactiva botones temporalmente
  ['physical', 'digital', 'audio'].forEach(f => {
    const btn = document.getElementById(`btn-${f}`);
    btn.style.pointerEvents = "none";
  });

  setTimeout(() => {
    // Actualiza precio
    const price = book.prices[format];
    document.getElementById("bookPrice").textContent = `$${price.toFixed(2)}`;

    // Actualiza botones visuales
    ['physical', 'digital', 'audio'].forEach(f => {
      const btn = document.getElementById(`btn-${f}`);
      btn.classList.toggle("active", f === format);
      btn.style.border = f === format ? "2px solid #007185" : "1px solid #d1d5db";
      btn.style.backgroundColor = f === format ? "#eef6fb" : "white";
      btn.style.pointerEvents = "auto";
    });

    // ACTUALIZA ESPECIFICACIONES 📘
    if (book.specs && book.specs[format]) {
      const specs = traducirSpecs(book.specs[format]);
document.getElementById("spec-pages").textContent = specs.pages;
document.getElementById("spec-language").textContent = specs.language;
document.getElementById("spec-publication").textContent = specs.publication;
document.getElementById("spec-dimensions").textContent = specs.dimensions;

    }

    loader.style.display = "none";
  }, 800);
}


// AGREGAR AL CARRITO
function handleAddToCart() {
  const selectedFormat = ['physical', 'digital', 'audio'].find(f =>
    document.getElementById(`btn-${f}`).classList.contains("active")
  );

  if (!selectedFormat || !book) return;

  const quantity = parseInt(document.getElementById("quantity").value, 10);
  const price = book.prices[selectedFormat];
  const id = `${slug}-${selectedFormat}`;
  const name = book.name;
  const formatLabel = { physical: "Paperback", digital: "eBook", audio: "Audiobook" }[selectedFormat];
  const image = book.image;

  addToCart(id, name + " - " + formatLabel, price, image, quantity);
  updateCartUI();
  document.getElementById("cartModal").classList.add("active");
}

function handleBuyNow() {
  handleAddToCart();
  window.location.href = "checkout1.html";
}

// GESTIÓN DEL CARRITO
function addToCart(id, name, price, image, quantity = 1, format = "Paperback") {
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  const existingItem = cart.find(item => item.id === id);

  if (existingItem) {
    existingItem.quantity += quantity;
  } else {
    cart.push({ id, name, price, image, quantity, format });
  }

  localStorage.setItem("cart", JSON.stringify(cart));
  updateCartCount(); // 👈 Asegúrate de actualizar justo después
  updateCartUI();

  const cartModal = document.getElementById("cartModal");
  if (cartModal) {
    cartModal.classList.add("active");
    document.body.style.overflow = "hidden";
  }
}


function updateCartUI() {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  const container = document.getElementById("cartItems");
  const count = document.getElementById("cartCount");
  const subtotalEl = document.getElementById("cartSubtotal");
  const taxEl = document.getElementById("cartTax");
  const totalEl = document.getElementById("cartTotal");

  container.innerHTML = "";
  let subtotal = 0;

  cart.forEach((item, index) => {
    const totalItem = item.price * item.quantity;
    subtotal += totalItem;

    const div = document.createElement("div");
    div.className = "cart-item";
    div.innerHTML = `
  <div class="cart-item">
  <a href="product-page.html?producto=${getSlugFromId(item.id)}">
    <img src="${item.image}" alt="cover" class="cart-item-image" style="width: 60px; height: 80px; border-radius: 0.1rem;">
  </a>

    <div class="cart-item-details">
      <p class="cart-item-title">${item.name}</p>
      <p class="cart-item-price">$${item.price.toFixed(2)} each</p>
    </div>
    <div class="cart-item-controls">
      <div class="quantity-selector">
        <button class="quantity-btn" onclick="updateQuantity(${index}, -1)">−</button>
        <span class="quantity-value">${item.quantity}</span>
        <button class="quantity-btn" onclick="updateQuantity(${index}, 1)">+</button>
      </div>
    </div>
  </div>
`;

    container.appendChild(div);
  });

function getSlugFromId(id) {
  // Extrae el slug del ID del carrito (ej. "silent-echo-digital" → "silent-echo")
  return id.split("-").slice(0, -1).join("-");
}


  const tax = subtotal * 0.085;
  const total = subtotal + tax;

  subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
  taxEl.textContent = `$${tax.toFixed(2)}`;
  totalEl.textContent = `$${total.toFixed(2)}`;
  count.textContent = cart.reduce((acc, item) => acc + item.quantity, 0);

  lucide.createIcons();
}

function updateQuantity(index, change) {
  let cart = JSON.parse(localStorage.getItem("cart")) || [];

  const item = cart[index];
  if (!item) return;

  // Encuentra el div del producto en el carrito
  const cartItems = document.getElementById("cartItems");
  const productDiv = cartItems.children[index];

  // Agrega clase y spinner
  if (productDiv) {
    productDiv.classList.add("loading");

    const spinner = document.createElement("div");
    spinner.className = "item-spinner";
    productDiv.appendChild(spinner);
  }

  // Simula carga y actualiza
  setTimeout(() => {
    item.quantity += change;

    if (item.quantity <= 0) {
      cart.splice(index, 1);
    }

    localStorage.setItem("cart", JSON.stringify(cart));
    updateCartUI();
  }, 1200);
}


function removeItem(index) {
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  cart.splice(index, 1);
  localStorage.setItem("cart", JSON.stringify(cart));
  updateCartUI();
}

// TOGGLE MODAL
function toggleCart() {
  const modal = document.getElementById("cartModal");
  modal.classList.toggle("active");

  // Controla el scroll según el estado del modal
  if (modal.classList.contains("active")) {
    document.body.style.overflow = "hidden";
  } else {
    document.body.style.overflow = "auto";
  }
}


// LIMPIAR CARRITO
function clearCart() {
  localStorage.removeItem("cart");
  updateCartUI();
}

// CHECKOUT
function checkout() {
  window.location.href = "checkout1.html";
}


// CARGA INICIAL
document.addEventListener("DOMContentLoaded", () => {
  updateCartUI();
  updateCartCount(); // 👈 Agrega esto aquí también

  if (book) {
    document.getElementById("bookTitle").textContent = book.name;
const currentLang = localStorage.getItem("language") || "es";
document.getElementById("bookDescription").textContent =
  currentLang === "en" && book.description_en ? book.description_en : book.description;

    document.getElementById("bookImage").src = book.image;
    document.getElementById("thumb1").src = book.image;
    document.getElementById("thumb2").src = book.image2;

if (book.rating) {
  const starsEl = document.getElementById("ratingStars");
  const textEl = document.getElementById("ratingText");

  let starsToFill = Math.round(book.rating.value); // redondea 3.5 → 4
let starsHtml = "";

// Estrellas doradas
for (let i = 0; i < starsToFill; i++) {
  starsHtml += `<span class="star filled">★</span>`;
}
// Estrellas grises
for (let i = starsToFill; i < 5; i++) {
  starsHtml += `<span class="star">★</span>`;
}

starsEl.innerHTML = starsHtml;
textEl.textContent = `${book.rating.value.toFixed(1)} rating (${book.rating.count} reviews)`;

}



    document.getElementById("price-physical").textContent = book.prices.physical.toFixed(2);
    document.getElementById("price-digital").textContent = book.prices.digital.toFixed(2);
    document.getElementById("price-audio").textContent = book.prices.audio.toFixed(2);

    selectFormatWithDelay("physical");

    // Imagen principal
document.getElementById("bookImage").src = book.image;

// Miniatura 1 (siempre existe)
document.getElementById("thumb1").src = book.image;
document.getElementById("thumb1").addEventListener("click", () => {
  document.getElementById("bookImage").src = book.image;
});

// Miniatura 2 (solo si existe)
if (book.image2) {
  document.getElementById("thumb2").src = book.image2;
  document.getElementById("thumb2").style.display = "inline-block"; // Por si estaba oculto antes
  document.getElementById("thumb2").addEventListener("click", () => {
    document.getElementById("bookImage").src = book.image2;
  });
} else {
  document.getElementById("thumb2").style.display = "none"; // Oculta el espacio visual
}

  
if (book.specs) {
  document.getElementById("spec-pages").textContent = book.specs.pages;
  document.getElementById("spec-language").textContent = book.specs.language;
  document.getElementById("spec-publication").textContent = book.specs.publication;
  document.getElementById("spec-dimensions").textContent = book.specs.dimensions;
}

}
});
